@using HotelApp.Web.ViewModels.Admin.BookingManagement.Report
@model BookingManagementReportRevenueSearchViewModel
@using System.Globalization

@{
    ViewData["Title"] = "Booking Revenue Report";
    var currentYear = DateTime.UtcNow.Year;
    var currentMonth = DateTime.UtcNow.Month;
}

<div class="container mt-5 mb-5">
    <div class="row justify-content-center mb-5">
        <div class="col-sm-12 col-lg-8 col-xl-6">
            <a asp-action="Index" class="btn btn-secondary fw-bold mb-3">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>

            <h3 class="text-center mb-4">@ViewData["Title"]</h3>

            <form asp-controller="BookingManagement" asp-action="ReportRevenueResult" method="get">
                <div class="mb-3">
                    <label asp-for="ReportSearch.Year" class="form-label">Year</label>
                    <select asp-for="ReportSearch.Year" class="form-select">
                        @for (int y = currentYear; y >= currentYear - 5; y--)  
                        {
                            <option value="@y" selected="@(Model.ReportSearch.Year == y ? "selected" : null)">
                                @y
                            </option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label asp-for="ReportSearch.Month" class="form-label">Month</label>
                    <select asp-for="ReportSearch.Month" class="form-select">
                        @for (int m = 1; m <= 12; m++)
                        {
                            <option value="@m" selected="@(Model.ReportSearch.Month == m || (Model.ReportSearch.Month == 0 && m == currentMonth) ? "selected" : null)">
                                @CultureInfo.GetCultureInfo("en-US").DateTimeFormat.GetMonthName(m)
                            </option>
                        }
                    </select>
                </div>
                <button type="submit" class="btn btn-danger w-100 py-2 fw-bold rounded">
                    Report
                </button>
            </form>
        </div>
    </div>

    @if (Model.ReportResults.Any())
    {
        <h4 class="mt-5 mb-2 text-center">@ViewData["Title"]</h4>
        <h4 class="mb-5 text-center">
            @CultureInfo.GetCultureInfo("en-US").DateTimeFormat.GetMonthName(Model.ReportSearch.Month) @Model.ReportSearch.Year
        </h4>

        <a asp-action="ReportRevenuePdf"
           asp-route-Year="@Model.ReportSearch.Year"
           asp-route-Month="@Model.ReportSearch.Month"
           class="btn btn-danger w-20 fw-bold mb-3">
            <i class="bi bi-file-earmark-pdf"></i> Download PDF
        </a>

        <div class="table-responsive">
            <table class="table table-dark table-hover shadow-lg rounded-3">
                <thead class="thead-dark">
                    <tr class="text-warning">
                        <th>Booking ID</th>
                        <th>Created On</th>
                        <th>Arrival Date</th>
                        <th>Departure Date</th>
                        <th>Status</th>
                        <th>Paid Amount</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var b in Model.ReportResults)
                    {
                        <tr>
                            <td class="align-middle">
                                <a class="text-light" asp-action="Details" asp-route-id="@b.Id" target="_blank">@b.Id</a>
                            </td>
                            <td class="align-middle">@b.CreatedOn</td>
                            <td class="align-middle">@b.DateArrival</td>
                            <td class="align-middle">@b.DateDeparture</td>
                            <td class="align-middle">@b.Status</td>
                            <td class="align-middle">@b.PaidCurrency@b.PaidAmount.ToString("0.00")</td>
                        </tr>
                    }
                    <tr>
                        <td colspan="5" class="text-end fw-bold">
                            Total Revenue
                        </td>
                        <td class="align-middle fw-bold">@Model.ReportResults.First().PaidCurrency@Model.TotalRevenue.ToString("0.00")</td>
                    </tr>
                </tbody>
            </table>
        </div>
    }
    else if (Model.HasReportSearched)
    {
        <div class="mt-4 text-center">
            Sorry, no bookings with paid @Model.ReportSearch.MonthYear.
        </div>
    }
</div>
