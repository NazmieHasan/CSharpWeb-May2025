@model HotelApp.Web.ViewModels.Admin.BookingManagement.BookingManagementDetailsViewModel

@{
    ViewData["Title"] = "Booking Details";
}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-4">
        </div>
        <div class="col-md-8">
            <h2 class="fw-bold text-primary mb-3">Booking Details</h2>
            <h6 class="card-title">Booking @Model.Id</h6>
            <hr />
            <p>Created On: @Model.CreatedOn.ToString("yyyy-MM-dd HH:mm:ss")</p>
            <p>
                Status: @Model.Status
                @if (Model.AllowedOperation == "AddPayment")
                {
                    <button class="btn btn-danger fw-bold shadow-sm"
                            onclick="AddPayment('@Model.Id')"
                            id="addPayment">
                        Add Payment
                    </button>
                    <div id="createPayment"></div>
                }
                else if (Model.AllowedOperation == "AddStay")
                {
                    <button class="btn btn-danger fw-bold shadow-sm"
                            onclick="AddStay('@Model.Id')"
                            id="addStay">
                        Add Stay
                    </button>
                    <div id="createStay"></div>
                }
            </p>
            @if (@Model.IsDeleted == true)
            {
                <p class="text-danger fw-bold">Add payment, add stay are not allowed. This booking has been deleted.</p>
            }
            <p>Created By: @Model.UserEmail</p>
            <p>Manager: @Model.ManagerEmail</p>
            <p>Arrival Date: @Model.DateArrival.ToString("yyyy-MM-dd")</p>
            <p>Departure Date: @Model.DateDeparture.ToString("yyyy-MM-dd")</p>
            <p>Day(s): @Model.DaysCount</p>
            <p>
                Room: 
                <a asp-area="Admin"
                    asp-controller="RoomManagement"
                    asp-action="Details"
                    asp-route-id="@Model.RoomId"
                    class="link-danger text-decoration-none"
                    target="_blank">
                    @Model.Room
                </a>
            </p>
            <p>Category: @Model.RoomCategory</p>
            <p>Total Amount $@Model.TotalAmount.ToString("0.00")</p>
            <p>Paid Amount $@Model.PaidAmount.ToString("0.00")</p>
            <p>Remaining Amount $@Model.RemainingAmount.ToString("0.00")</p>
            <p>Adults: @Model.AdultsCount</p>
            <p>Children: @Model.ChildCount</p>
            <p>Babies: @Model.BabyCount</p>
            <p>Is Deleted: @Model.IsDeleted</p>
            <div class="mt-4 mb-5">
                <a asp-action="Index" class="btn btn-outline-primary ms-2">
                    <i class="bi bi-arrow-left"></i> Back to List
                </a>
            </div>


            <h4 class="mt-5 fw-bold text-secondary">Payment History</h4>

            @if (Model.Payments != null && Model.Payments.Any())
            {
                <table class="table table-dark table-striped mt-3 mb-5">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Paid By</th>
                            <th>Phone</th>
                            <th>Payment Method</th>
                            <th>Is Deleted</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var payment in Model.Payments)
                        {
                            <tr>
                                <td>@payment.CreatedOn.ToString("yyyy-MM-dd HH:mm")</td>
                                <td>$@payment.Amount.ToString("0.00")</td>
                                <td>@payment.PaymentUserFullName</td>
                                <td>@payment.PaymentUserPhoneNumber</td>
                                <td>@payment.PaymentMethodName</td>
                                <td>
                                    @(payment.IsDeleted ? "Yes" : "No")
                                </td>
                                <td>
                                    <a asp-controller="PaymentManagement"
                                       asp-action="Details"
                                       asp-route-id="@payment.Id"
                                       class="text-info fw-bold" target="_blank">
                                        Details
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">No payments have been created for this booking yet.</p>
            }


            <h4 class="mt-5 fw-bold text-secondary">Stay History</h4>

            @if (Model.Stays != null && Model.Stays.Any())
            {
                <table class="table table-dark table-striped mt-3 mb-5">
                    <thead>
                        <tr>
                            <th>Guest Name and Family</th>
                            <th>Guest Age</th>
                            <th>Created On</th>
                            <th>Is Completed</th>
                            <th>Is Deleted</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var stay in Model.Stays)
                        {
                            <tr>
                                <td>@stay.GuestFirstName @stay.GuestFamilyName</td>
                                <td>@stay.GuestAge</td>
                                <td>@stay.CreatedOn.ToString("yyyy-MM-dd HH:mm")</td>
                                <td>
                                    @if (stay.CheckoutOn == null)
                                    {
                                        <span>No</span>
                                        <form method="post" asp-action="Edit" asp-controller="StayManagement" class="d-inline">
                                            <input type="hidden" name="Id" value="@stay.Id" />
                                            <input type="hidden" name="BookingId" value="@Guid.Parse(Model.Id)" />
                                            <button type="submit" class="btn btn-danger btn-sm m-0 fw-bold ms-2">Check Out</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <span>Yes (@stay.CheckoutOn.Value.ToString("yyyy-MM-dd HH:mm"))</span>
                                    }
                                </td>

                                <td>
                                    @(stay.IsDeleted ? "Yes" : "No")
                                </td>
                                <td>
                                    <a asp-controller="StayManagement"
                                       asp-action="Details"
                                       asp-route-id="@stay.Id"
                                       class="text-info fw-bold" target="_blank">
                                        Details
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">No stays have been created for this booking yet.</p>
            }

        </div>
    </div>
</div>

<script src="~/js/admin/paymentManagement.js" asp-append-version="true"></script>
<script src="~/js/admin/stayManagement.js" asp-append-version="true"></script>
